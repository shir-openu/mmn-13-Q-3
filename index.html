<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¤×ª×¨×•×Ÿ ××¢×¨×›×ª ××©×•×•××•×ª ×“×™×¤×¨× ×¦×™××œ×™×•×ª - ××¢×¨×›×ª 3Ã—3 ××™-×”×•××•×’× ×™×ª</title>
    <style>
        :root {
            --bg: #0b1220;
            --card-bg: #141d2b;
            --border: #2d3a4f;
            --ink: #e5e7eb;
            --teal: #11a8a0;
            --magenta: #f472b6;
            --purple: #a78bfa;
            --green: #22c55e;
            --orange: #f59e0b;
            --red: #ef4444;
            --calc-bg: #0c1526;
            --blue: #3b82f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: var(--bg);
            color: var(--ink);
            min-height: 100vh;
            padding: 20px;
            font-size: 1rem;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: var(--teal);
            font-size: 1.8rem;
            font-weight: 400;
        }

        .subtitle {
            text-align: center;
            margin-bottom: 20px;
            color: var(--ink);
            opacity: 0.7;
            font-size: 1rem;
        }

        .problem-statement {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: var(--card-bg);
            border: 2px solid var(--teal);
            border-radius: 16px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .problem-statement h2 {
            color: var(--teal);
            font-size: 1.3rem;
            margin-bottom: 15px;
            font-weight: 400;
        }

        .problem-math {
            font-family: 'Times New Roman', serif;
            font-size: 1.2rem;
            direction: ltr;
            line-height: 2;
        }

        .equation-system {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .equation-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Last step (5th) takes full width centered */
        .container .phase:nth-child(5) {
            grid-column: 1 / -1;
            max-width: 680px;
            justify-self: center;
            width: 100%;
        }

        .phase {
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            opacity: 0.4;
            transition: opacity 0.5s ease;
        }

        .phase.active {
            opacity: 1;
        }

        .phase.step1 { border-color: var(--purple); }
        .phase.step2 { border-color: var(--orange); }
        .phase.step3 { border-color: var(--green); }
        .phase.step4 { border-color: var(--blue); }
        .phase.step5 { border-color: var(--teal); }

        .phase-title {
            text-align: center;
            font-size: 1.4rem;
            margin-bottom: 15px;
            font-weight: 400;
        }

        .phase.step1 .phase-title { color: var(--purple); }
        .phase.step2 .phase-title { color: var(--orange); }
        .phase.step3 .phase-title { color: var(--green); }
        .phase.step4 .phase-title { color: var(--blue); }
        .phase.step5 .phase-title { color: var(--teal); }

        .phase-description {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            font-size: 1rem;
            line-height: 1.5;
        }

        .guiding-question {
            background: rgba(167, 139, 250, 0.1);
            border: 1px solid var(--purple);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .guiding-question h3 {
            color: var(--purple);
            font-size: 1rem;
            font-weight: 400;
            margin-bottom: 10px;
        }

        .guiding-question p {
            font-size: 1rem;
            line-height: 1.6;
        }

        .guiding-question .math {
            font-family: 'Times New Roman', serif;
            font-size: 1.1rem;
            direction: ltr;
            margin: 10px 0;
        }

        /* Input styles */
        .input-section {
            margin: 15px 0;
            text-align: center;
        }

        .input-section label {
            display: block;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .input-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            direction: ltr;
            font-family: 'Times New Roman', serif;
            font-size: 1.1rem;
            margin: 10px 0;
        }

        .input-row input {
            width: 80px;
            height: 38px;
            text-align: center;
            font-size: 1rem;
            font-family: 'Times New Roman', serif;
            background: var(--calc-bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--ink);
            outline: none;
            transition: border-color 0.2s;
        }

        .input-row input:focus {
            border-color: var(--teal);
        }

        .input-row input.correct {
            border-color: var(--green);
            background: rgba(34, 197, 94, 0.1);
        }

        .input-row input.incorrect {
            border-color: var(--red);
            background: rgba(239, 68, 68, 0.1);
        }

        /* Buttons */
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 10px 20px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--calc-bg);
            color: var(--ink);
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .control-btn:hover {
            border-color: var(--teal);
            background: rgba(17, 168, 160, 0.2);
        }

        .control-btn.primary {
            border-color: var(--green);
            background: rgba(34, 197, 94, 0.2);
        }

        .control-btn.primary:hover {
            background: rgba(34, 197, 94, 0.4);
        }

        .control-btn.show-solution {
            border-color: var(--orange);
            background: rgba(245, 158, 11, 0.2);
        }

        .control-btn.show-solution:hover {
            background: rgba(245, 158, 11, 0.4);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* DF Button - Digital Friend */
        .df-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .df-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .df-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .df-icon {
            font-size: 1.3rem;
        }

        /* AI Chat Box */
        .ai-chat-box {
            margin-top: 15px;
            padding: 15px;
            background: #1a1f35;
            border: 2px solid #667eea;
            border-radius: 12px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .ai-chat-box.visible {
            display: block;
        }

        .ai-chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .ai-chat-title {
            color: #667eea;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-close-btn {
            background: var(--calc-bg);
            border: 1px solid var(--border);
            color: var(--ink);
            padding: 5px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .ai-close-btn:hover {
            border-color: var(--red);
        }

        .ai-message {
            margin: 10px 0;
            padding: 12px;
            background: var(--calc-bg);
            border-radius: 8px;
            line-height: 1.7;
            font-size: 1rem;
        }

        .ai-message.user {
            background: rgba(102, 126, 234, 0.2);
            border-right: 3px solid #667eea;
        }

        .ai-message.assistant {
            background: rgba(34, 197, 94, 0.1);
            border-right: 3px solid var(--green);
        }

        .ai-loading {
            color: var(--ink);
            opacity: 0.7;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Solution display */
        .solution-box {
            background: var(--calc-bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            direction: ltr;
            font-family: 'Times New Roman', serif;
            line-height: 1.8;
            display: none;
        }

        .solution-box.visible {
            display: block;
        }

        .solution-box h4 {
            color: var(--teal);
            font-weight: 400;
            margin-bottom: 10px;
            text-align: center;
            direction: rtl;
        }

        .solution-step {
            margin: 10px 0;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }

        .solution-step .label {
            color: var(--purple);
            font-size: 1rem;
            margin-bottom: 5px;
            direction: rtl;
            text-align: right;
        }

        .solution-step .math {
            font-size: 1.05rem;
            text-align: center;
        }

        /* Result highlight */
        .result-highlight {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid var(--green);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .result-highlight h4 {
            color: var(--green);
            margin-bottom: 10px;
            font-weight: 400;
        }

        .result-highlight .math {
            font-family: 'Times New Roman', serif;
            font-size: 1.15rem;
            direction: ltr;
        }

        /* Feedback messages */
        .feedback {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            display: none;
        }

        .feedback.visible {
            display: block;
        }

        .feedback.success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid var(--green);
            color: var(--green);
        }

        .feedback.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--red);
            color: var(--red);
        }

        /* Highlight colors */
        .hl-teal { color: var(--teal); font-weight: 500; }
        .hl-purple { color: var(--purple); font-weight: 500; }
        .hl-green { color: var(--green); font-weight: 500; }
        .hl-orange { color: var(--orange); font-weight: 500; }
        .hl-blue { color: var(--blue); font-weight: 500; }

        /* Navigation buttons */
        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .nav-btn {
            padding: 12px 30px;
            border: 2px solid var(--teal);
            border-radius: 10px;
            background: rgba(17, 168, 160, 0.2);
            color: var(--ink);
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background: rgba(17, 168, 160, 0.4);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Progress indicator */
        .progress-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .progress-step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            background: var(--card-bg);
            border: 2px solid var(--border);
            color: var(--ink);
            opacity: 0.5;
            transition: all 0.3s;
        }

        .progress-step.active {
            opacity: 1;
            border-color: var(--teal);
            background: rgba(17, 168, 160, 0.2);
        }

        .progress-step.completed {
            opacity: 1;
            border-color: var(--green);
            background: rgba(34, 197, 94, 0.3);
            color: var(--green);
        }

        .progress-connector {
            width: 40px;
            height: 2px;
            background: var(--border);
            align-self: center;
        }

        .progress-connector.completed {
            background: var(--green);
        }

        /* Method explanation box */
        .method-box {
            background: rgba(167, 139, 250, 0.1);
            border: 1px solid var(--purple);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .method-box h3 {
            color: var(--purple);
            font-size: 1.1rem;
            margin-bottom: 10px;
            text-align: center;
            font-weight: 400;
        }

        .method-box p {
            font-size: 1rem;
            line-height: 1.6;
            text-align: center;
        }

        @media (max-width: 1000px) {
            .container {
                grid-template-columns: 1fr;
            }
            .container .phase:nth-child(5) {
                max-width: 100%;
            }
        }

        /* Footer */
        .site-footer {
            position: fixed;
            bottom: 10px;
            left: 10px;
            font-size: 13px;
            color: var(--ink);
            opacity: 0.7;
        }

        /* Equation highlight */
        .eq-highlight {
            background: rgba(17, 168, 160, 0.15);
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        /* Popup overlay */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .popup-overlay.show {
            display: flex;
        }
        .popup {
            background: var(--card-bg);
            border: 2px solid var(--purple);
            border-radius: 16px;
            padding: 24px;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            direction: rtl;
        }
        .popup h2 {
            margin: 0 0 16px 0;
            font-size: 1.3rem;
            font-weight: 400;
            color: var(--purple);
            text-align: center;
        }
        .popup-close {
            position: absolute;
            top: 12px;
            left: 12px;
            background: none;
            border: none;
            color: var(--ink);
            font-size: 24px;
            cursor: pointer;
            padding: 4px 8px;
            opacity: 0.7;
        }
        .popup-close:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <h1>×¤×ª×¨×•×Ÿ ××¢×¨×›×ª ××©×•×•××•×ª ×“×™×¤×¨× ×¦×™××œ×™×•×ª</h1>
    <div class="subtitle">××¢×¨×›×ª 3Ã—3 ××™-×”×•××•×’× ×™×ª ×¢× ×¢×¨×š ×¢×¦××™ ×›×¤×•×œ</div>

    <!-- Problem Statement -->
    <div class="problem-statement">
        <h2>×”×©××œ×”</h2>
        <div class="problem-math">
            <div class="equation-system">
                <div>××¦××• ××ª ×”×¤×ª×¨×•×Ÿ ×”×›×œ×œ×™ ×©×œ ×”××¢×¨×›×ª:</div>
                <div style="margin-top: 10px; line-height: 2.2;">
                    dx/dt = 4x âˆ’ y âˆ’ z + e<sup>3t</sup><br>
                    dy/dt = x + 5y + 2z + e<sup>3t</sup><br>
                    dz/dt = y + 5z
                </div>
                <div class="equation-row" style="margin-top: 15px;">
                    <span>A = </span>
                    <span style="display: inline-flex; align-items: center;">
                        <span style="border-left: 2px solid white; border-top: 2px solid white; border-bottom: 2px solid white; border-radius: 8px 0 0 8px; padding: 8px 4px; margin-right: 2px;">&nbsp;</span>
                        <span style="display: inline-flex; flex-direction: column; text-align: center; line-height: 1.6;">
                            <span>&nbsp;4 &nbsp; âˆ’1 &nbsp; âˆ’1&nbsp;</span>
                            <span>&nbsp;1 &nbsp;&nbsp; 5 &nbsp;&nbsp;&nbsp; 2&nbsp;</span>
                            <span>&nbsp;0 &nbsp;&nbsp; 1 &nbsp;&nbsp;&nbsp; 5&nbsp;</span>
                        </span>
                        <span style="border-right: 2px solid white; border-top: 2px solid white; border-bottom: 2px solid white; border-radius: 0 8px 8px 0; padding: 8px 4px; margin-left: 2px;">&nbsp;</span>
                    </span>
                    <span style="margin-left: 30px;">b = e<sup>3t</sup></span>
                    <span style="display: inline-flex; align-items: center;">
                        <span style="border-left: 2px solid white; border-top: 2px solid white; border-bottom: 2px solid white; border-radius: 8px 0 0 8px; padding: 8px 4px; margin-right: 2px;">&nbsp;</span>
                        <span style="display: inline-flex; flex-direction: column; text-align: center; line-height: 1.6;">
                            <span>1</span>
                            <span>1</span>
                            <span>0</span>
                        </span>
                        <span style="border-right: 2px solid white; border-top: 2px solid white; border-bottom: 2px solid white; border-radius: 0 8px 8px 0; padding: 8px 4px; margin-left: 2px;">&nbsp;</span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Method explanation -->
    <div class="method-box">
        <h3>×©×™×˜×ª ×”×¤×ª×¨×•×Ÿ</h3>
        <p>
            ××¢×¨×›×ª ××™-×”×•××•×’× ×™×ª x' = Ax + b. × ××¦× ××ª ×”×¤×ª×¨×•×Ÿ ×”×”×•××•×’× ×™ (3 ×¤×ª×¨×•× ×•×ª ×‘×œ×ª×™ ×ª×œ×•×™×™×)
            ×•××ª ×”×¤×ª×¨×•×Ÿ ×”×¤×¨×˜×™. Î»=4 ×”×•× ×¢×¨×š ×¢×¦××™ ×›×¤×•×œ ×•×“×•×¨×© ×•×§×˜×•×¨ ××•×›×œ×œ.
        </p>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar">
        <div class="progress-step active" id="prog1">1</div>
        <div class="progress-connector" id="conn1"></div>
        <div class="progress-step" id="prog2">2</div>
        <div class="progress-connector" id="conn2"></div>
        <div class="progress-step" id="prog3">3</div>
        <div class="progress-connector" id="conn3"></div>
        <div class="progress-step" id="prog4">4</div>
        <div class="progress-connector" id="conn4"></div>
        <div class="progress-step" id="prog5">5</div>
    </div>

    <div class="container">
        <!-- Step 1: Find Eigenvalues -->
        <div class="phase step1 active" id="phase1">
            <div class="phase-title">×©×œ×‘ 1: ××¦×™××ª ×¢×¨×›×™× ×¢×¦××™×™×</div>

            <div class="phase-description">
                ××¦××• ××ª ×”×¢×¨×›×™× ×”×¢×¦××™×™× ×©×œ ×”××˜×¨×™×¦×” A ×¢×œ ×™×“×™ ×¤×ª×¨×•×Ÿ |Î»I âˆ’ A| = 0
            </div>

            <div class="guiding-question">
                <h3>×©××œ×” ×× ×—×”</h3>
                <p>×—×©×‘×• ××ª ×”×¤×•×œ×™× ×•× ×”××•×¤×™×™× ×™ |Î»I âˆ’ A| ×•××¦××• ××ª ×©×•×¨×©×™×•</p>
                <div class="math">
                    <span class="eq-highlight">|Î»I âˆ’ A| = (Î»âˆ’4)Â²(Î»âˆ’6)</span>
                </div>
                <p style="margin-top: 10px; font-size: 1rem;">×¨××–: ×™×©× × ×©× ×™ ×¢×¨×›×™× ×¢×¦××™×™× ×©×•× ×™×, ××—×“ ××”× ×›×¤×•×œ</p>
            </div>

            <div class="input-section">
                <label>××”× ×”×¢×¨×›×™× ×”×¢×¦××™×™×?</label>
                <div class="input-row">
                    <span>×¢×¨×š ×¢×¦××™ ×¤×©×•×˜: Î»â‚ =</span>
                    <input type="text" id="lambda1" placeholder="?">
                </div>
                <div class="input-row">
                    <span>×¢×¨×š ×¢×¦××™ ×›×¤×•×œ: Î»â‚‚ =</span>
                    <input type="text" id="lambda2" placeholder="?">
                </div>
            </div>

            <div class="feedback" id="feedback1"></div>

            <div class="controls">
                <button class="control-btn primary" id="check1">×‘×“×§×• ×ª×©×•×‘×”</button>
                <button class="control-btn show-solution" id="show1">×”×¦×™×’×• ×¤×ª×¨×•×Ÿ</button>
                <button class="df-btn" id="df1">
                    <span class="df-icon">ğŸ§</span>
                    <span>Digital Friend</span>
                </button>
            </div>

            <!-- AI Chat Box for Step 1 -->
            <div class="ai-chat-box" id="aiChat1">
                <div class="ai-chat-header">
                    <span class="ai-chat-title">
                        <span>ğŸ§</span>
                        <span>Digital Friend - ×©×œ×‘ 1</span>
                    </span>
                    <button class="ai-close-btn" onclick="closeAIChat(1)">×¡×’×™×¨×” Ã—</button>
                </div>
                <div class="ai-messages" id="aiMessages1"></div>
            </div>

            <div class="solution-box" id="solution1">
                <h4>×¤×ª×¨×•×Ÿ ×©×œ×‘ 1</h4>
                <div class="solution-step">
                    <div class="label">×”×¤×•×œ×™× ×•× ×”××•×¤×™×™× ×™:</div>
                    <div class="math">|Î»I âˆ’ A| = (Î»âˆ’4)Â²(Î»âˆ’6)</div>
                </div>
                <div class="result-highlight">
                    <h4>×”×¢×¨×›×™× ×”×¢×¦××™×™×</h4>
                    <div class="math">
                        <span class="hl-purple">Î»â‚ = 6 (×¤×©×•×˜), Î»â‚‚ = 4 (×›×¤×•×œ)</span>
                    </div>
                </div>
            </div>

            <!-- Inline navigation -->
            <div class="inline-nav" style="text-align: center; margin-top: 20px;">
                <button class="nav-btn" onclick="showStep(2)">â† ×©×œ×‘ ×”×‘×</button>
            </div>
        </div>

        <!-- Step 2: Eigenvector for Î»=6 -->
        <div class="phase step2" id="phase2">
            <div class="phase-title">×©×œ×‘ 2: ×•×§×˜×•×¨ ×¢×¦××™ ×¢×‘×•×¨ Î»=6</div>

            <div class="phase-description">
                ××¦××• ×•×§×˜×•×¨ ×¢×¦××™ vâ‚ ×¢×‘×•×¨ ×”×¢×¨×š ×”×¢×¦××™ ×”×¤×©×•×˜ Î» = 6
            </div>

            <div class="guiding-question">
                <h3>×©××œ×” ×× ×—×”</h3>
                <p>×¤×ª×¨×• ××ª ×”××¢×¨×›×ª (6I âˆ’ A)v = 0</p>
                <div class="math">
                    <span class="eq-highlight">(6I âˆ’ A) = [2, 1, 1; âˆ’1, 1, âˆ’2; 0, âˆ’1, 1]</span>
                </div>
                <p style="margin-top: 10px; font-size: 1rem;">×¨××–: ×“×¨×’×• ××ª ×”××˜×¨×™×¦×” ×•××¦××• ×•×§×˜×•×¨ ×¢×¦××™</p>
            </div>

            <div class="input-section">
                <label>××”×• ×”×•×§×˜×•×¨ ×”×¢×¦××™ vâ‚ ×¢×‘×•×¨ Î» = 6?</label>
                <div class="input-row">
                    <span>vâ‚ = [</span>
                    <input type="text" id="v1-1" placeholder="?">
                    <span>,</span>
                    <input type="text" id="v1-2" placeholder="?">
                    <span>,</span>
                    <input type="text" id="v1-3" placeholder="?">
                    <span>]<sup>T</sup></span>
                </div>
                <p style="font-size: 1rem; opacity: 0.7; margin-top: 5px;">×”×–×™× ×• ××¡×¤×¨×™× ×©×œ××™× (×›×œ ×›×¤×•×œ×” ×¡×§×œ×¨×™×ª ××ª×§×‘×œ×ª)</p>
            </div>

            <div class="feedback" id="feedback2"></div>

            <div class="controls">
                <button class="control-btn primary" id="check2">×‘×“×§×• ×ª×©×•×‘×”</button>
                <button class="control-btn show-solution" id="show2">×”×¦×™×’×• ×¤×ª×¨×•×Ÿ</button>
                <button class="df-btn" id="df2">
                    <span class="df-icon">ğŸ§</span>
                    <span>Digital Friend</span>
                </button>
            </div>

            <!-- AI Chat Box for Step 2 -->
            <div class="ai-chat-box" id="aiChat2">
                <div class="ai-chat-header">
                    <span class="ai-chat-title">
                        <span>ğŸ§</span>
                        <span>Digital Friend - ×©×œ×‘ 2</span>
                    </span>
                    <button class="ai-close-btn" onclick="closeAIChat(2)">×¡×’×™×¨×” Ã—</button>
                </div>
                <div class="ai-messages" id="aiMessages2"></div>
            </div>

            <div class="solution-box" id="solution2">
                <h4>×¤×ª×¨×•×Ÿ ×©×œ×‘ 2</h4>
                <div class="solution-step">
                    <div class="label">×”××˜×¨×™×¦×” (6I âˆ’ A):</div>
                    <div class="math">[2, 1, 1; âˆ’1, 1, âˆ’2; 0, âˆ’1, 1]</div>
                </div>
                <div class="solution-step">
                    <div class="label">×“×™×¨×•×’ ×•×¤×ª×¨×•×Ÿ:</div>
                    <div class="math">vâ‚ = [âˆ’1, 1, 1]<sup>T</sup></div>
                </div>
                <div class="result-highlight">
                    <h4>×”×•×§×˜×•×¨ ×”×¢×¦××™</h4>
                    <div class="math">
                        <span class="hl-orange">vâ‚ = [âˆ’1, 1, 1]<sup>T</sup></span>
                    </div>
                </div>
            </div>

            <!-- Inline navigation -->
            <div class="inline-nav" style="text-align: center; margin-top: 20px;">
                <button class="nav-btn" onclick="showStep(1)" style="margin-left: 10px;">×©×œ×‘ ×§×•×“× â†’</button>
                <button class="nav-btn" onclick="showStep(3)">â† ×©×œ×‘ ×”×‘×</button>
            </div>
        </div>

        <!-- Step 3: Eigenvector for Î»=4 -->
        <div class="phase step3" id="phase3">
            <div class="phase-title">×©×œ×‘ 3: ×•×§×˜×•×¨ ×¢×¦××™ ×¢×‘×•×¨ Î»=4</div>

            <div class="phase-description">
                ××¦××• ×•×§×˜×•×¨ ×¢×¦××™ vâ‚‚ ×¢×‘×•×¨ ×”×¢×¨×š ×”×¢×¦××™ ×”×›×¤×•×œ Î» = 4
            </div>

            <div class="guiding-question">
                <h3>×©××œ×” ×× ×—×”</h3>
                <p>×¤×ª×¨×• ××ª ×”××¢×¨×›×ª (4I âˆ’ A)v = 0</p>
                <div class="math">
                    <span class="eq-highlight">(4I âˆ’ A) = [0, 1, 1; âˆ’1, âˆ’1, âˆ’2; 0, âˆ’1, âˆ’1]</span>
                </div>
                <p style="margin-top: 10px; font-size: 1rem;">×¨××–: ×œ×¢×¨×š ×¢×¦××™ ×›×¤×•×œ ×™×© ×•×§×˜×•×¨ ×¢×¦××™ ××—×“ ×‘×œ×‘×“ (×¨×™×‘×•×™ ×’××•××˜×¨×™ 1)</p>
            </div>

            <div class="input-section">
                <label>××”×• ×”×•×§×˜×•×¨ ×”×¢×¦××™ vâ‚‚ ×¢×‘×•×¨ Î» = 4?</label>
                <div class="input-row">
                    <span>vâ‚‚ = [</span>
                    <input type="text" id="v2-1" placeholder="?">
                    <span>,</span>
                    <input type="text" id="v2-2" placeholder="?">
                    <span>,</span>
                    <input type="text" id="v2-3" placeholder="?">
                    <span>]<sup>T</sup></span>
                </div>
                <p style="font-size: 1rem; opacity: 0.7; margin-top: 5px;">×”×–×™× ×• ××¡×¤×¨×™× ×©×œ××™× (×›×œ ×›×¤×•×œ×” ×¡×§×œ×¨×™×ª ××ª×§×‘×œ×ª)</p>
            </div>

            <div class="feedback" id="feedback3"></div>

            <div class="controls">
                <button class="control-btn primary" id="check3">×‘×“×§×• ×ª×©×•×‘×”</button>
                <button class="control-btn show-solution" id="show3">×”×¦×™×’×• ×¤×ª×¨×•×Ÿ</button>
                <button class="df-btn" id="df3">
                    <span class="df-icon">ğŸ§</span>
                    <span>Digital Friend</span>
                </button>
            </div>

            <!-- AI Chat Box for Step 3 -->
            <div class="ai-chat-box" id="aiChat3">
                <div class="ai-chat-header">
                    <span class="ai-chat-title">
                        <span>ğŸ§</span>
                        <span>Digital Friend - ×©×œ×‘ 3</span>
                    </span>
                    <button class="ai-close-btn" onclick="closeAIChat(3)">×¡×’×™×¨×” Ã—</button>
                </div>
                <div class="ai-messages" id="aiMessages3"></div>
            </div>

            <div class="solution-box" id="solution3">
                <h4>×¤×ª×¨×•×Ÿ ×©×œ×‘ 3</h4>
                <div class="solution-step">
                    <div class="label">×”××˜×¨×™×¦×” (4I âˆ’ A):</div>
                    <div class="math">[0, 1, 1; âˆ’1, âˆ’1, âˆ’2; 0, âˆ’1, âˆ’1]</div>
                </div>
                <div class="solution-step">
                    <div class="label">×“×™×¨×•×’ ×•×¤×ª×¨×•×Ÿ:</div>
                    <div class="math">vâ‚‚ = [1, 1, âˆ’1]<sup>T</sup></div>
                </div>
                <div class="result-highlight">
                    <h4>×”×•×§×˜×•×¨ ×”×¢×¦××™</h4>
                    <div class="math">
                        <span class="hl-green">vâ‚‚ = [1, 1, âˆ’1]<sup>T</sup></span>
                    </div>
                </div>
            </div>

            <!-- Inline navigation -->
            <div class="inline-nav" style="text-align: center; margin-top: 20px;">
                <button class="nav-btn" onclick="showStep(2)" style="margin-left: 10px;">×©×œ×‘ ×§×•×“× â†’</button>
                <button class="nav-btn" onclick="showStep(4)">â† ×©×œ×‘ ×”×‘×</button>
            </div>
        </div>

        <!-- Step 4: Generalized Eigenvector -->
        <div class="phase step4" id="phase4">
            <div class="phase-title">×©×œ×‘ 4: ×•×§×˜×•×¨ ××•×›×œ×œ (×¤×ª×¨×•×Ÿ ×©×œ×™×©×™)</div>

            <div class="phase-description">
                ××›×™×•×•×Ÿ ×©-Î»=4 ×”×•× ×¢×¨×š ×¢×¦××™ ×›×¤×•×œ ×¢× ×•×§×˜×•×¨ ×¢×¦××™ ××—×“, ×¦×¨×™×š ×•×§×˜×•×¨ ××•×›×œ×œ w.<br>
                ×”×¤×ª×¨×•×Ÿ ×”×©×œ×™×©×™: xâ‚ƒ(t) = te<sup>4t</sup>vâ‚‚ + e<sup>4t</sup>w
            </div>

            <div class="guiding-question">
                <h3>×©××œ×” ×× ×—×”</h3>
                <p>×¤×ª×¨×• ××ª ×”××¢×¨×›×ª (A âˆ’ 4I)w = vâ‚‚ ×›×“×™ ×œ××¦×•× ××ª w</p>
                <div class="math">
                    <span class="eq-highlight">(A âˆ’ 4I)w = vâ‚‚ = [1, 1, âˆ’1]<sup>T</sup></span>
                </div>
                <p style="margin-top: 10px; font-size: 1rem;">×¨××–: wâ‚ ×”×•× ×¤×¨××˜×¨ ×—×•×¤×©×™ (×‘×—×¨×• wâ‚ = 0). ××¦××• ××ª wâ‚‚ ×•-wâ‚ƒ</p>
            </div>

            <div class="input-section">
                <label>××”× ×¨×›×™×‘×™ ×”×•×§×˜×•×¨ ×”××•×›×œ×œ w? (×¢× ×‘×—×™×¨×ª wâ‚ = 0)</label>
                <div class="input-row">
                    <span>wâ‚‚ =</span>
                    <input type="text" id="w2-val" placeholder="?">
                    <span style="margin-left: 20px;">wâ‚ƒ =</span>
                    <input type="text" id="w3-val" placeholder="?">
                </div>
            </div>

            <div class="feedback" id="feedback4"></div>

            <div class="controls">
                <button class="control-btn primary" id="check4">×‘×“×§×• ×ª×©×•×‘×”</button>
                <button class="control-btn show-solution" id="show4">×”×¦×™×’×• ×¤×ª×¨×•×Ÿ</button>
                <button class="df-btn" id="df4">
                    <span class="df-icon">ğŸ§</span>
                    <span>Digital Friend</span>
                </button>
            </div>

            <!-- AI Chat Box for Step 4 -->
            <div class="ai-chat-box" id="aiChat4">
                <div class="ai-chat-header">
                    <span class="ai-chat-title">
                        <span>ğŸ§</span>
                        <span>Digital Friend - ×©×œ×‘ 4</span>
                    </span>
                    <button class="ai-close-btn" onclick="closeAIChat(4)">×¡×’×™×¨×” Ã—</button>
                </div>
                <div class="ai-messages" id="aiMessages4"></div>
            </div>

            <div class="solution-box" id="solution4">
                <h4>×¤×ª×¨×•×Ÿ ×©×œ×‘ 4</h4>
                <div class="solution-step">
                    <div class="label">×”××©×•×•××” (A âˆ’ 4I)w = vâ‚‚:</div>
                    <div class="math">[0, âˆ’1, âˆ’1; 1, 1, 2; 0, 1, 1] Â· w = [1, 1, âˆ’1]<sup>T</sup></div>
                </div>
                <div class="solution-step">
                    <div class="label">×¤×ª×¨×•×Ÿ ×”××¢×¨×›×ª:</div>
                    <div class="math">wâ‚ = t (×—×•×¤×©×™), wâ‚‚ = âˆ’3, wâ‚ƒ = 2<br>×‘×—×™×¨×ª wâ‚ = 0: w = [0, âˆ’3, 2]<sup>T</sup></div>
                </div>
                <div class="solution-step">
                    <div class="label">×”×¤×ª×¨×•×Ÿ ×”×©×œ×™×©×™:</div>
                    <div class="math">xâ‚ƒ(t) = te<sup>4t</sup>[1,1,âˆ’1]<sup>T</sup> + e<sup>4t</sup>[0,âˆ’3,2]<sup>T</sup> = e<sup>4t</sup>[t, tâˆ’3, 2âˆ’t]<sup>T</sup></div>
                </div>
                <div class="result-highlight">
                    <h4>×”×•×§×˜×•×¨ ×”××•×›×œ×œ ×•×”×¤×ª×¨×•×Ÿ ×”×©×œ×™×©×™</h4>
                    <div class="math">
                        <span class="hl-blue">w = [0, âˆ’3, 2]<sup>T</sup></span><br>
                        <span class="hl-blue">xâ‚ƒ(t) = e<sup>4t</sup>[t, tâˆ’3, 2âˆ’t]<sup>T</sup></span>
                    </div>
                </div>
            </div>

            <!-- Inline navigation -->
            <div class="inline-nav" style="text-align: center; margin-top: 20px;">
                <button class="nav-btn" onclick="showStep(3)" style="margin-left: 10px;">×©×œ×‘ ×§×•×“× â†’</button>
                <button class="nav-btn" onclick="showStep(5)">â† ×©×œ×‘ ×”×‘×</button>
            </div>
        </div>

        <!-- Step 5: Particular Solution -->
        <div class="phase step5" id="phase5">
            <div class="phase-title">×©×œ×‘ 5: ×¤×ª×¨×•×Ÿ ×¤×¨×˜×™</div>

            <div class="phase-description">
                ××›×™×•×•×Ÿ ×©-3 ××™× ×• ×¢×¨×š ×¢×¦××™, × × ×¡×” ×¤×ª×¨×•×Ÿ ×¤×¨×˜×™ ××”×¦×•×¨×” x<sub>p</sub> = e<sup>3t</sup>[aâ‚, aâ‚‚, aâ‚ƒ]<sup>T</sup>
            </div>

            <div class="guiding-question">
                <h3>×©××œ×” ×× ×—×”</h3>
                <p>×”×¦×™×‘×• x<sub>p</sub> = e<sup>3t</sup>[aâ‚, aâ‚‚, aâ‚ƒ]<sup>T</sup> ×‘××¢×¨×›×ª ×•×¤×ª×¨×• ×¢×‘×•×¨ aâ‚, aâ‚‚, aâ‚ƒ</p>
                <div class="math">
                    <span class="eq-highlight">(3I âˆ’ A)[aâ‚, aâ‚‚, aâ‚ƒ]<sup>T</sup> = [1, 1, 0]<sup>T</sup></span>
                </div>
                <p style="margin-top: 10px; font-size: 1rem;">×¨××–: ×¤×ª×¨×• ××¢×¨×›×ª ×©×œ 3 ××©×•×•××•×ª ×‘-3 × ×¢×œ××™×</p>
            </div>

            <div class="input-section">
                <label>××”× ×¢×¨×›×™ ×”××§×“××™×?</label>
                <div class="input-row">
                    <span>aâ‚ =</span>
                    <input type="text" id="a1-val" placeholder="?">
                    <span style="margin-left: 15px;">aâ‚‚ =</span>
                    <input type="text" id="a2-val" placeholder="?">
                    <span style="margin-left: 15px;">aâ‚ƒ =</span>
                    <input type="text" id="a3-val" placeholder="?">
                </div>
            </div>

            <div class="feedback" id="feedback5"></div>

            <div class="controls">
                <button class="control-btn primary" id="check5">×‘×“×§×• ×ª×©×•×‘×”</button>
                <button class="control-btn show-solution" id="show5">×”×¦×™×’×• ×¤×ª×¨×•×Ÿ</button>
                <button class="df-btn" id="df5">
                    <span class="df-icon">ğŸ§</span>
                    <span>Digital Friend</span>
                </button>
            </div>

            <!-- AI Chat Box for Step 5 -->
            <div class="ai-chat-box" id="aiChat5">
                <div class="ai-chat-header">
                    <span class="ai-chat-title">
                        <span>ğŸ§</span>
                        <span>Digital Friend - ×©×œ×‘ 5</span>
                    </span>
                    <button class="ai-close-btn" onclick="closeAIChat(5)">×¡×’×™×¨×” Ã—</button>
                </div>
                <div class="ai-messages" id="aiMessages5"></div>
            </div>

            <div class="solution-box" id="solution5">
                <h4>×¤×ª×¨×•×Ÿ ×©×œ×‘ 5</h4>
                <div class="solution-step">
                    <div class="label">×”×¦×‘×ª x<sub>p</sub> ×‘××¢×¨×›×ª:</div>
                    <div class="math">3e<sup>3t</sup>[aâ‚,aâ‚‚,aâ‚ƒ]<sup>T</sup> = Ae<sup>3t</sup>[aâ‚,aâ‚‚,aâ‚ƒ]<sup>T</sup> + e<sup>3t</sup>[1,1,0]<sup>T</sup></div>
                </div>
                <div class="solution-step">
                    <div class="label">×¤×™×©×•×˜:</div>
                    <div class="math">(3I âˆ’ A)[aâ‚,aâ‚‚,aâ‚ƒ]<sup>T</sup> = [1,1,0]<sup>T</sup></div>
                </div>
                <div class="solution-step">
                    <div class="label">×¤×ª×¨×•×Ÿ:</div>
                    <div class="math">aâ‚ = âˆ’1, aâ‚‚ = 0, aâ‚ƒ = 0</div>
                </div>
                <div class="result-highlight">
                    <h4>×”×¤×ª×¨×•×Ÿ ×”×¤×¨×˜×™</h4>
                    <div class="math">
                        <span class="hl-teal">x<sub>p</sub>(t) = e<sup>3t</sup>[âˆ’1, 0, 0]<sup>T</sup></span>
                    </div>
                </div>
            </div>

            <!-- Final Answer -->
            <div class="solution-box" id="final-answer" style="display: none;">
                <h4>×”×¤×ª×¨×•×Ÿ ×”×›×œ×œ×™</h4>
                <div class="result-highlight" style="background: rgba(17, 168, 160, 0.15); border-color: var(--teal);">
                    <div class="math" style="font-size: 1.05rem; line-height: 2;">
                        x(t) = âˆ’Câ‚e<sup>6t</sup> + Câ‚‚e<sup>4t</sup> + Câ‚ƒte<sup>4t</sup> âˆ’ e<sup>3t</sup><br>
                        y(t) = Câ‚e<sup>6t</sup> + Câ‚‚e<sup>4t</sup> + Câ‚ƒ(tâˆ’3)e<sup>4t</sup><br>
                        z(t) = Câ‚e<sup>6t</sup> âˆ’ Câ‚‚e<sup>4t</sup> + Câ‚ƒ(2âˆ’t)e<sup>4t</sup>
                    </div>
                </div>
            </div>

            <!-- Inline navigation -->
            <div class="inline-nav" style="text-align: center; margin-top: 20px;">
                <button class="nav-btn" onclick="showStep(4)">×©×œ×‘ ×§×•×“× â†’</button>
            </div>
        </div>
    </div>

    <!-- Popup for Step 1 Solution -->
    <div class="popup-overlay" id="popup1Overlay">
        <div class="popup">
            <button class="popup-close" id="popup1Close">&times;</button>
            <h2>×¤×ª×¨×•×Ÿ ×©×œ×‘ 1 - ××¦×™××ª ×¢×¨×›×™× ×¢×¦××™×™×</h2>

            <div class="solution-step">
                <div class="label">×”×¤×•×œ×™× ×•× ×”××•×¤×™×™× ×™ |Î»I âˆ’ A|:</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.05rem;">
                    |Î»I âˆ’ A| = det[Î»âˆ’4, 1, 1; âˆ’1, Î»âˆ’5, âˆ’2; 0, âˆ’1, Î»âˆ’5]
                </div>
            </div>

            <div class="solution-step">
                <div class="label">×¤×™×ª×•×— ×”×“×˜×¨××™× × ×˜×”:</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.05rem; line-height: 1.8;">
                    = (Î»âˆ’4)[(Î»âˆ’5)(Î»âˆ’5) âˆ’ (âˆ’2)(âˆ’1)] âˆ’ 1[(âˆ’1)(Î»âˆ’5) âˆ’ (âˆ’2)(0)] + 1[(âˆ’1)(âˆ’1) âˆ’ (Î»âˆ’5)(0)]<br>
                    = (Î»âˆ’4)(Î»Â²âˆ’10Î»+25âˆ’2) âˆ’ 1(âˆ’Î»+5) + 1(1)<br>
                    = (Î»âˆ’4)(Î»Â²âˆ’10Î»+23) + Î» âˆ’ 5 + 1<br>
                    = (Î»âˆ’4)(Î»Â²âˆ’10Î»+23) + Î» âˆ’ 4<br>
                    = (Î»âˆ’4)(Î»Â²âˆ’10Î»+24)<br>
                    = (Î»âˆ’4)(Î»âˆ’4)(Î»âˆ’6)
                </div>
            </div>

            <div class="result-highlight">
                <h4>×”×¢×¨×›×™× ×”×¢×¦××™×™×</h4>
                <div class="math" style="direction: ltr; font-family: 'Times New Roman', serif; font-size: 1.15rem;">
                    <span class="hl-purple">Î»â‚ = 6 (×¤×©×•×˜), Î»â‚‚ = 4 (×›×¤×•×œ, ×¨×™×‘×•×™ ××œ×’×‘×¨×™ 2)</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup for Step 2 Solution -->
    <div class="popup-overlay" id="popup2Overlay">
        <div class="popup" style="border-color: var(--orange);">
            <button class="popup-close" id="popup2Close">&times;</button>
            <h2 style="color: var(--orange);">×¤×ª×¨×•×Ÿ ×©×œ×‘ 2 - ×•×§×˜×•×¨ ×¢×¦××™ ×¢×‘×•×¨ Î»=6</h2>

            <div class="solution-step">
                <div class="label">×”××˜×¨×™×¦×” (6I âˆ’ A):</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.05rem;">
                    6I âˆ’ A = [2, 1, 1; âˆ’1, 1, âˆ’2; 0, âˆ’1, 1]
                </div>
            </div>

            <div class="solution-step">
                <div class="label">×“×™×¨×•×’ ×©×•×¨×•×ª:</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.05rem; line-height: 1.8;">
                    Râ‚‚ â†’ Râ‚‚ + Â½Râ‚: [2, 1, 1; 0, 3/2, âˆ’3/2; 0, âˆ’1, 1]<br>
                    Râ‚ƒ â†’ Râ‚ƒ + â…”Râ‚‚: [2, 1, 1; 0, 3/2, âˆ’3/2; 0, 0, 0]
                </div>
            </div>

            <div class="solution-step">
                <div class="label">×¤×ª×¨×•×Ÿ:</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.05rem; line-height: 1.8;">
                    vâ‚ƒ = t (×—×•×¤×©×™), vâ‚‚ = t, vâ‚ = âˆ’t<br>
                    ×‘×—×™×¨×ª t = 1: vâ‚ = [âˆ’1, 1, 1]<sup>T</sup>
                </div>
            </div>

            <div class="result-highlight">
                <h4>×”×•×§×˜×•×¨ ×”×¢×¦××™</h4>
                <div class="math" style="direction: ltr; font-family: 'Times New Roman', serif; font-size: 1.15rem;">
                    <span class="hl-orange">vâ‚ = [âˆ’1, 1, 1]<sup>T</sup></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup for Step 3 Solution -->
    <div class="popup-overlay" id="popup3Overlay">
        <div class="popup" style="border-color: var(--green);">
            <button class="popup-close" id="popup3Close">&times;</button>
            <h2 style="color: var(--green);">×¤×ª×¨×•×Ÿ ×©×œ×‘ 3 - ×•×§×˜×•×¨ ×¢×¦××™ ×¢×‘×•×¨ Î»=4</h2>

            <div class="solution-step">
                <div class="label">×”××˜×¨×™×¦×” (4I âˆ’ A):</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.05rem;">
                    4I âˆ’ A = [0, 1, 1; âˆ’1, âˆ’1, âˆ’2; 0, âˆ’1, âˆ’1]
                </div>
            </div>

            <div class="solution-step">
                <div class="label">×“×™×¨×•×’ ×©×•×¨×•×ª:</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.05rem; line-height: 1.8;">
                    Râ‚ƒ â†’ Râ‚ƒ + Râ‚: [0, 1, 1; âˆ’1, âˆ’1, âˆ’2; 0, 0, 0]<br>
                    Râ‚‚ â†’ Râ‚‚ + Râ‚ (swap): [âˆ’1, âˆ’1, âˆ’2; 0, 1, 1; 0, 0, 0]
                </div>
            </div>

            <div class="solution-step">
                <div class="label">×¤×ª×¨×•×Ÿ:</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.05rem; line-height: 1.8;">
                    vâ‚ƒ = t (×—×•×¤×©×™), vâ‚‚ = âˆ’t, vâ‚ = t<br>
                    ×‘×—×™×¨×ª t = âˆ’1: vâ‚‚ = [1, 1, âˆ’1]<sup>T</sup>
                </div>
            </div>

            <div class="solution-step">
                <div class="label">×”×¢×¨×” ×—×©×•×‘×”:</div>
                <div class="math" style="direction: rtl; text-align: center; font-size: 1rem;">
                    ×”×¨×™×‘×•×™ ×”×’××•××˜×¨×™ ×”×•× 1 (×•×§×˜×•×¨ ×¢×¦××™ ××—×“ ×‘×œ×‘×“), ×‘×¢×•×“ ×”×¨×™×‘×•×™ ×”××œ×’×‘×¨×™ ×”×•× 2.<br>
                    ×œ×›×Ÿ × ×¦×˜×¨×š ×•×§×˜×•×¨ ××•×›×œ×œ ×‘×©×œ×‘ ×”×‘×.
                </div>
            </div>

            <div class="result-highlight">
                <h4>×”×•×§×˜×•×¨ ×”×¢×¦××™</h4>
                <div class="math" style="direction: ltr; font-family: 'Times New Roman', serif; font-size: 1.15rem;">
                    <span class="hl-green">vâ‚‚ = [1, 1, âˆ’1]<sup>T</sup></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup for Step 4 Solution (DETAILED - generalized eigenvector) -->
    <div class="popup-overlay" id="popup4Overlay">
        <div class="popup" style="border-color: var(--blue); max-width: 750px;">
            <button class="popup-close" id="popup4Close">&times;</button>
            <h2 style="color: var(--blue);">×¤×ª×¨×•×Ÿ ×©×œ×‘ 4 - ×•×§×˜×•×¨ ××•×›×œ×œ ×•×¤×ª×¨×•×Ÿ ×©×œ×™×©×™ (×¤×™×¨×•×˜ ××œ×)</h2>

            <div class="solution-step">
                <div class="label">×©×œ×‘ ×': ×œ××” ×¦×¨×™×š ×•×§×˜×•×¨ ××•×›×œ×œ?</div>
                <div class="math" style="direction: rtl; text-align: center; font-size: 1rem; line-height: 1.8;">
                    Î»=4 ×”×•× ×¢×¨×š ×¢×¦××™ ×›×¤×•×œ (×¨×™×‘×•×™ ××œ×’×‘×¨×™ 2) ××‘×œ ×™×© ×œ×• ×¨×§ ×•×§×˜×•×¨ ×¢×¦××™ ××—×“ (×¨×™×‘×•×™ ×’××•××˜×¨×™ 1).<br>
                    ×œ×›×Ÿ ×”×¤×ª×¨×•×Ÿ ×”×©×œ×™×©×™ ××™× ×• ××”×¦×•×¨×” ×”×¨×’×™×œ×” e<sup>Î»t</sup>v, ××œ× ×“×•×¨×© ×•×§×˜×•×¨ ××•×›×œ×œ.
                </div>
            </div>

            <div class="solution-step">
                <div class="label">×©×œ×‘ ×‘': ×¦×•×¨×ª ×”×¤×ª×¨×•×Ÿ ×”×©×œ×™×©×™</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.05rem;">
                    xâ‚ƒ(t) = te<sup>4t</sup>vâ‚‚ + e<sup>4t</sup>w
                </div>
            </div>

            <div class="solution-step">
                <div class="label">×©×œ×‘ ×’': ××¦×™××ª w - ×¤×ª×¨×•×Ÿ (A âˆ’ 4I)w = vâ‚‚</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1rem; line-height: 1.8;">
                    [0, âˆ’1, âˆ’1; 1, 1, 2; 0, 1, 1] Â· [wâ‚; wâ‚‚; wâ‚ƒ] = [1; 1; âˆ’1]
                </div>
            </div>

            <div class="solution-step">
                <div class="label">×©×œ×‘ ×“': ×¤×ª×¨×•×Ÿ ×”××¢×¨×›×ª</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1rem; line-height: 1.8;">
                    ××©×•×•××” 1: âˆ’wâ‚‚ âˆ’ wâ‚ƒ = 1<br>
                    ××©×•×•××” 3: wâ‚‚ + wâ‚ƒ = âˆ’1 (×–×”×” ×œ××©×•×•××” 1)<br>
                    ××©×•×•××” 2: wâ‚ + wâ‚‚ + 2wâ‚ƒ = 1<br><br>
                    ×××©×•×•××” 1: wâ‚‚ = âˆ’1 âˆ’ wâ‚ƒ<br>
                    ×”×¦×‘×” ×‘××©×•×•××” 2: wâ‚ + (âˆ’1 âˆ’ wâ‚ƒ) + 2wâ‚ƒ = 1<br>
                    wâ‚ + wâ‚ƒ = 2 â†’ wâ‚ƒ = 2 âˆ’ wâ‚<br>
                    wâ‚‚ = âˆ’1 âˆ’ (2 âˆ’ wâ‚) = wâ‚ âˆ’ 3<br><br>
                    ×‘×—×™×¨×ª wâ‚ = 0: <strong>wâ‚‚ = âˆ’3, wâ‚ƒ = 2</strong>
                </div>
            </div>

            <div class="solution-step">
                <div class="label">×©×œ×‘ ×”': ×”×¤×ª×¨×•×Ÿ ×”×©×œ×™×©×™</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.05rem; line-height: 1.8;">
                    xâ‚ƒ(t) = te<sup>4t</sup>[1;1;âˆ’1] + e<sup>4t</sup>[0;âˆ’3;2]<br>
                    = e<sup>4t</sup>[t; tâˆ’3; âˆ’t+2]<br>
                    = e<sup>4t</sup>[t; tâˆ’3; 2âˆ’t]
                </div>
            </div>

            <div class="result-highlight">
                <h4>×”×•×§×˜×•×¨ ×”××•×›×œ×œ ×•×”×¤×ª×¨×•×Ÿ ×”×©×œ×™×©×™</h4>
                <div class="math" style="direction: ltr; font-family: 'Times New Roman', serif; font-size: 1.1rem; line-height: 2;">
                    <span class="hl-blue">w = [0, âˆ’3, 2]<sup>T</sup></span><br>
                    <span class="hl-blue">xâ‚ƒ(t) = e<sup>4t</sup>[t, tâˆ’3, 2âˆ’t]<sup>T</sup></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup for Step 5 Solution -->
    <div class="popup-overlay" id="popup5Overlay">
        <div class="popup" style="border-color: var(--teal);">
            <button class="popup-close" id="popup5Close">&times;</button>
            <h2 style="color: var(--teal);">×¤×ª×¨×•×Ÿ ×©×œ×‘ 5 - ×¤×ª×¨×•×Ÿ ×¤×¨×˜×™</h2>

            <div class="solution-step">
                <div class="label">×”×¦×‘×ª x<sub>p</sub> = e<sup>3t</sup>[aâ‚, aâ‚‚, aâ‚ƒ]<sup>T</sup> ×‘××¢×¨×›×ª:</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.05rem; line-height: 1.8;">
                    3e<sup>3t</sup>[aâ‚;aâ‚‚;aâ‚ƒ] = AÂ·e<sup>3t</sup>[aâ‚;aâ‚‚;aâ‚ƒ] + e<sup>3t</sup>[1;1;0]
                </div>
            </div>

            <div class="solution-step">
                <div class="label">×¦××¦×•× e<sup>3t</sup> ×•×¤×™×©×•×˜:</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.05rem;">
                    (3I âˆ’ A)[aâ‚;aâ‚‚;aâ‚ƒ] = [1;1;0]
                </div>
            </div>

            <div class="solution-step">
                <div class="label">×”××˜×¨×™×¦×” (3I âˆ’ A):</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.05rem;">
                    [âˆ’1, 1, 1; âˆ’1, âˆ’2, âˆ’2; 0, âˆ’1, âˆ’2]
                </div>
            </div>

            <div class="solution-step">
                <div class="label">×¤×ª×¨×•×Ÿ ×”××¢×¨×›×ª:</div>
                <div class="math" style="direction: ltr; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.05rem; line-height: 1.8;">
                    ×××©×•×•××” 3: aâ‚‚ + 2aâ‚ƒ = 0 â†’ aâ‚‚ = âˆ’2aâ‚ƒ<br>
                    ×××©×•×•××” 2: âˆ’aâ‚ âˆ’ 2aâ‚‚ âˆ’ 2aâ‚ƒ = 1 â†’ âˆ’aâ‚ + 4aâ‚ƒ âˆ’ 2aâ‚ƒ = 1 â†’ âˆ’aâ‚ + 2aâ‚ƒ = 1<br>
                    ×××©×•×•××” 1: âˆ’aâ‚ + aâ‚‚ + aâ‚ƒ = 1 â†’ âˆ’aâ‚ âˆ’ 2aâ‚ƒ + aâ‚ƒ = 1 â†’ âˆ’aâ‚ âˆ’ aâ‚ƒ = 1<br><br>
                    ×××©×•×•××•×ª 2 ×•-1: 2aâ‚ƒ âˆ’ (âˆ’aâ‚ƒ) = 0 â†’ 3aâ‚ƒ = 0 â†’ aâ‚ƒ = 0<br>
                    aâ‚‚ = 0, aâ‚ = âˆ’1
                </div>
            </div>

            <div class="result-highlight">
                <h4>×”×¤×ª×¨×•×Ÿ ×”×¤×¨×˜×™</h4>
                <div class="math" style="direction: ltr; font-family: 'Times New Roman', serif; font-size: 1.15rem;">
                    <span class="hl-teal">x<sub>p</sub>(t) = e<sup>3t</sup>[âˆ’1, 0, 0]<sup>T</sup></span>
                </div>
            </div>

            <div class="result-highlight" style="background: rgba(17, 168, 160, 0.15); border-color: var(--teal); margin-top: 15px;">
                <h4 style="color: var(--teal);">×”×¤×ª×¨×•×Ÿ ×”×›×œ×œ×™</h4>
                <div class="math" style="direction: ltr; font-family: 'Times New Roman', serif; font-size: 1.05rem; line-height: 2;">
                    x(t) = âˆ’Câ‚e<sup>6t</sup> + Câ‚‚e<sup>4t</sup> + Câ‚ƒte<sup>4t</sup> âˆ’ e<sup>3t</sup><br>
                    y(t) = Câ‚e<sup>6t</sup> + Câ‚‚e<sup>4t</sup> + Câ‚ƒ(tâˆ’3)e<sup>4t</sup><br>
                    z(t) = Câ‚e<sup>6t</sup> âˆ’ Câ‚‚e<sup>4t</sup> + Câ‚ƒ(2âˆ’t)e<sup>4t</sup>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Endpoint - Vercel serverless function (will be updated after deployment)
        const API_ENDPOINT = 'https://mmn-13-q-3.vercel.app/api/ai-hint';

        // Conversation history per step
        const conversationHistory = {
            1: [],
            2: [],
            3: [],
            4: [],
            5: []
        };

        // Problem data for each step
        const problemData = {
            1: {
                correctAnswer: "Î»â‚ = 6 (simple), Î»â‚‚ = 4 (double)",
                fullSolution: "Î»â‚ = 6, Î»â‚‚ = 4\n\n×©×œ×‘×™ ×”×¤×ª×¨×•×Ÿ:\n1. ×”×¤×•×œ×™× ×•× ×”××•×¤×™×™× ×™: |Î»I - A| = (Î»-4)Â²(Î»-6)\n2. ×©×•×¨×©×™×: Î» = 6 (×¤×©×•×˜), Î» = 4 (×›×¤×•×œ)"
            },
            2: {
                correctAnswer: "vâ‚ = [-1, 1, 1]^T (or scalar multiple)",
                fullSolution: "vâ‚ = [-1, 1, 1]^T\n\n×©×œ×‘×™ ×”×¤×ª×¨×•×Ÿ:\n1. (6I - A) = [2, 1, 1; -1, 1, -2; 0, -1, 1]\n2. ×“×™×¨×•×’ ×©×•×¨×•×ª\n3. vâ‚ = [-1, 1, 1]^T"
            },
            3: {
                correctAnswer: "vâ‚‚ = [1, 1, -1]^T (or scalar multiple)",
                fullSolution: "vâ‚‚ = [1, 1, -1]^T\n\n×©×œ×‘×™ ×”×¤×ª×¨×•×Ÿ:\n1. (4I - A) = [0, 1, 1; -1, -1, -2; 0, -1, -1]\n2. ×“×™×¨×•×’ ×©×•×¨×•×ª\n3. vâ‚‚ = [1, 1, -1]^T"
            },
            4: {
                correctAnswer: "w = [0, -3, 2]^T (wâ‚‚ = -3, wâ‚ƒ = 2)",
                fullSolution: "w = [0, -3, 2]^T\n\n×©×œ×‘×™ ×”×¤×ª×¨×•×Ÿ:\n1. (A - 4I)w = vâ‚‚\n2. ×¤×ª×¨×•×Ÿ ×”××¢×¨×›×ª: wâ‚ ×—×•×¤×©×™, wâ‚‚ = wâ‚ - 3, wâ‚ƒ = 2 - wâ‚\n3. ×‘×—×™×¨×ª wâ‚ = 0: w = [0, -3, 2]^T\n4. ×”×¤×ª×¨×•×Ÿ ×”×©×œ×™×©×™: xâ‚ƒ(t) = e^{4t}[t, t-3, 2-t]^T"
            },
            5: {
                correctAnswer: "aâ‚ = -1, aâ‚‚ = 0, aâ‚ƒ = 0",
                fullSolution: "aâ‚ = -1, aâ‚‚ = 0, aâ‚ƒ = 0\n\n×©×œ×‘×™ ×”×¤×ª×¨×•×Ÿ:\n1. ×”×¦×‘×ª x_p = e^{3t}[aâ‚,aâ‚‚,aâ‚ƒ]^T ×‘××¢×¨×›×ª\n2. (3I - A)[aâ‚,aâ‚‚,aâ‚ƒ]^T = [1,1,0]^T\n3. ×¤×ª×¨×•×Ÿ: aâ‚ = -1, aâ‚‚ = 0, aâ‚ƒ = 0\n4. x_p = e^{3t}[-1, 0, 0]^T"
            }
        };

        // State
        let currentStep = 1;
        const totalSteps = 5;
        let stepCompleted = [false, false, false, false, false];

        // DOM elements
        const phases = document.querySelectorAll('.phase');
        const progressSteps = document.querySelectorAll('.progress-step');
        const connectors = document.querySelectorAll('.progress-connector');

        // Update UI based on current step
        function updateUI() {
            phases.forEach((phase, index) => {
                if (index + 1 === currentStep) {
                    phase.classList.add('active');
                } else {
                    phase.classList.remove('active');
                }
            });

            progressSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 === currentStep) {
                    step.classList.add('active');
                } else if (stepCompleted[index]) {
                    step.classList.add('completed');
                }
            });

            connectors.forEach((conn, index) => {
                if (stepCompleted[index]) {
                    conn.classList.add('completed');
                } else {
                    conn.classList.remove('completed');
                }
            });
        }

        // Show feedback
        function showFeedback(element, message, isSuccess) {
            element.textContent = message;
            element.className = 'feedback visible ' + (isSuccess ? 'success' : 'error');
        }

        // Normalize answer for comparison
        function normalize(str) {
            if (!str) return '';
            return str.toLowerCase()
                .replace(/\s+/g, '')
                .replace(/\*/g, '')
                .replace(/\^/g, '')
                .replace(/Â²/g, '2');
        }

        // Check if eigenvector is scalar multiple of expected
        function checkEigenvector(inputs, expected) {
            const vals = inputs.map(id => parseFloat(document.getElementById(id).value));
            if (vals.some(isNaN)) return false;

            // Check all are zero
            if (vals.every(v => v === 0)) return false;

            // Find first non-zero expected component
            let ratio = null;
            for (let i = 0; i < expected.length; i++) {
                if (expected[i] !== 0) {
                    ratio = vals[i] / expected[i];
                    break;
                }
            }
            if (ratio === null || ratio === 0) return false;

            // Check all components have same ratio
            for (let i = 0; i < expected.length; i++) {
                if (Math.abs(vals[i] - ratio * expected[i]) > 0.001) return false;
            }
            return true;
        }

        // Get user input for current step
        function getUserInput(step) {
            if (step === 1) {
                const l1 = document.getElementById('lambda1').value;
                const l2 = document.getElementById('lambda2').value;
                return `Î»â‚ = ${l1}, Î»â‚‚ = ${l2}`;
            } else if (step === 2) {
                const v1 = document.getElementById('v1-1').value;
                const v2 = document.getElementById('v1-2').value;
                const v3 = document.getElementById('v1-3').value;
                return `vâ‚ = [${v1}, ${v2}, ${v3}]^T`;
            } else if (step === 3) {
                const v1 = document.getElementById('v2-1').value;
                const v2 = document.getElementById('v2-2').value;
                const v3 = document.getElementById('v2-3').value;
                return `vâ‚‚ = [${v1}, ${v2}, ${v3}]^T`;
            } else if (step === 4) {
                const w2 = document.getElementById('w2-val').value;
                const w3 = document.getElementById('w3-val').value;
                return `wâ‚‚ = ${w2}, wâ‚ƒ = ${w3}`;
            } else {
                const a1 = document.getElementById('a1-val').value;
                const a2 = document.getElementById('a2-val').value;
                const a3 = document.getElementById('a3-val').value;
                return `aâ‚ = ${a1}, aâ‚‚ = ${a2}, aâ‚ƒ = ${a3}`;
            }
        }

        // AI Chat functions
        async function askDigitalFriend(step) {
            const userInput = getUserInput(step);
            const chatBox = document.getElementById(`aiChat${step}`);
            const messagesDiv = document.getElementById(`aiMessages${step}`);

            // Show chat box
            chatBox.classList.add('visible');

            // Show loading
            messagesDiv.innerHTML += `
                <div class="ai-message ai-loading">
                    <div class="spinner"></div>
                    <span>××¢×‘×“ ××ª ×”×ª×©×•×‘×”...</span>
                </div>
            `;

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userInput: userInput,
                        currentStep: step,
                        problemData: problemData[step],
                        conversationHistory: conversationHistory[step]
                    })
                });

                const data = await response.json();

                // Remove loading
                const loadingEl = messagesDiv.querySelector('.ai-loading');
                if (loadingEl) loadingEl.remove();

                if (data.error) {
                    messagesDiv.innerHTML += `
                        <div class="ai-message" style="color: var(--red);">
                            ×©×’×™××”: ${data.error}
                        </div>
                    `;
                    return;
                }

                // Save to history
                conversationHistory[step].push({
                    user: userInput,
                    ai: data.hint
                });

                // Display conversation
                displayConversation(step);

            } catch (error) {
                const loadingEl = messagesDiv.querySelector('.ai-loading');
                if (loadingEl) loadingEl.remove();

                messagesDiv.innerHTML += `
                    <div class="ai-message" style="color: var(--red);">
                        ×œ× × ×™×ª×Ÿ ×œ×”×ª×—×‘×¨ ×œ×©×¨×ª. ×•×“××• ×©×”×©×¨×ª ×”××§×•××™ ×¤×•×¢×œ.
                    </div>
                `;
                console.error('API Error:', error);
            }
        }

        function displayConversation(step) {
            const messagesDiv = document.getElementById(`aiMessages${step}`);
            let html = '';

            conversationHistory[step].forEach((turn, i) => {
                html += `
                    <div class="ai-message user">
                        <strong>× ×™×¡×™×•×Ÿ #${i + 1}:</strong> ${turn.user}
                    </div>
                    <div class="ai-message assistant">
                        ${turn.ai}
                    </div>
                `;
            });

            messagesDiv.innerHTML = html;
        }

        function closeAIChat(step) {
            document.getElementById(`aiChat${step}`).classList.remove('visible');
        }

        // Check Step 1 (eigenvalues)
        document.getElementById('check1').addEventListener('click', () => {
            const l1 = normalize(document.getElementById('lambda1').value);
            const l2 = normalize(document.getElementById('lambda2').value);

            const correct = (l1 === '6' && l2 === '4') || (l1 === '4' && l2 === '6');

            document.getElementById('lambda1').className = (l1 === '6' || (l1 === '4' && l2 === '6')) ? 'correct' : 'incorrect';
            document.getElementById('lambda2').className = (l2 === '4' || (l2 === '6' && l1 === '4')) ? 'correct' : 'incorrect';

            if (l1 === '6' && l2 === '4') {
                document.getElementById('lambda1').className = 'correct';
                document.getElementById('lambda2').className = 'correct';
                showFeedback(document.getElementById('feedback1'), 'âœ“ ××¦×•×™×Ÿ! ×”×¢×¨×›×™× ×”×¢×¦××™×™× × ×›×•× ×™×', true);
                stepCompleted[0] = true;
                updateUI();
            } else if (l1 === '4' && l2 === '6') {
                // Swapped - still correct values but wrong placement
                showFeedback(document.getElementById('feedback1'), 'âœ— ×”×¢×¨×›×™× × ×›×•× ×™× ××‘×œ ×©×™××• ×œ×‘: Î»â‚ ×”×•× ×”×¤×©×•×˜ (6) ×•-Î»â‚‚ ×”×•× ×”×›×¤×•×œ (4)', false);
            } else {
                showFeedback(document.getElementById('feedback1'), 'âœ— ×‘×“×§×• ×©×•×‘ ××ª ×”×¤×•×œ×™× ×•× ×”××•×¤×™×™× ×™', false);
            }
        });

        // Show Step 1 solution in popup
        const popup1Overlay = document.getElementById('popup1Overlay');
        const popup1Close = document.getElementById('popup1Close');

        document.getElementById('show1').addEventListener('click', () => {
            popup1Overlay.classList.add('show');
            stepCompleted[0] = true;
            updateUI();
        });

        popup1Close.addEventListener('click', () => {
            popup1Overlay.classList.remove('show');
        });

        popup1Overlay.addEventListener('click', (e) => {
            if (e.target === popup1Overlay) {
                popup1Overlay.classList.remove('show');
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.popup-overlay').forEach(p => p.classList.remove('show'));
            }
        });

        // DF Button Step 1
        document.getElementById('df1').addEventListener('click', () => askDigitalFriend(1));

        // Check Step 2 (eigenvector for Î»=6)
        document.getElementById('check2').addEventListener('click', () => {
            const correct = checkEigenvector(['v1-1', 'v1-2', 'v1-3'], [-1, 1, 1]);

            const inputs = ['v1-1', 'v1-2', 'v1-3'];
            inputs.forEach(id => {
                document.getElementById(id).className = correct ? 'correct' : 'incorrect';
            });

            if (correct) {
                showFeedback(document.getElementById('feedback2'), 'âœ“ ××¦×•×™×Ÿ! ×”×•×§×˜×•×¨ ×”×¢×¦××™ × ×›×•×Ÿ', true);
                stepCompleted[1] = true;
                updateUI();
            } else {
                showFeedback(document.getElementById('feedback2'), 'âœ— ×‘×“×§×• ×©×•×‘ - ×¤×ª×¨×• (6I-A)v=0', false);
            }
        });

        // Show Step 2 solution in popup
        const popup2Overlay = document.getElementById('popup2Overlay');
        const popup2Close = document.getElementById('popup2Close');

        document.getElementById('show2').addEventListener('click', () => {
            popup2Overlay.classList.add('show');
            stepCompleted[1] = true;
            updateUI();
        });

        popup2Close.addEventListener('click', () => {
            popup2Overlay.classList.remove('show');
        });

        popup2Overlay.addEventListener('click', (e) => {
            if (e.target === popup2Overlay) {
                popup2Overlay.classList.remove('show');
            }
        });

        // DF Button Step 2
        document.getElementById('df2').addEventListener('click', () => askDigitalFriend(2));

        // Check Step 3 (eigenvector for Î»=4)
        document.getElementById('check3').addEventListener('click', () => {
            const correct = checkEigenvector(['v2-1', 'v2-2', 'v2-3'], [1, 1, -1]);

            const inputs = ['v2-1', 'v2-2', 'v2-3'];
            inputs.forEach(id => {
                document.getElementById(id).className = correct ? 'correct' : 'incorrect';
            });

            if (correct) {
                showFeedback(document.getElementById('feedback3'), 'âœ“ ××¦×•×™×Ÿ! ×”×•×§×˜×•×¨ ×”×¢×¦××™ × ×›×•×Ÿ', true);
                stepCompleted[2] = true;
                updateUI();
            } else {
                showFeedback(document.getElementById('feedback3'), 'âœ— ×‘×“×§×• ×©×•×‘ - ×¤×ª×¨×• (4I-A)v=0', false);
            }
        });

        // Show Step 3 solution in popup
        const popup3Overlay = document.getElementById('popup3Overlay');
        const popup3Close = document.getElementById('popup3Close');

        document.getElementById('show3').addEventListener('click', () => {
            popup3Overlay.classList.add('show');
            stepCompleted[2] = true;
            updateUI();
        });

        popup3Close.addEventListener('click', () => {
            popup3Overlay.classList.remove('show');
        });

        popup3Overlay.addEventListener('click', (e) => {
            if (e.target === popup3Overlay) {
                popup3Overlay.classList.remove('show');
            }
        });

        // DF Button Step 3
        document.getElementById('df3').addEventListener('click', () => askDigitalFriend(3));

        // Check Step 4 (generalized eigenvector)
        document.getElementById('check4').addEventListener('click', () => {
            const w2 = normalize(document.getElementById('w2-val').value);
            const w3 = normalize(document.getElementById('w3-val').value);

            const w2Correct = w2 === '-3';
            const w3Correct = w3 === '2';

            document.getElementById('w2-val').className = w2Correct ? 'correct' : 'incorrect';
            document.getElementById('w3-val').className = w3Correct ? 'correct' : 'incorrect';

            if (w2Correct && w3Correct) {
                showFeedback(document.getElementById('feedback4'), 'âœ“ ××¦×•×™×Ÿ! ×”×•×§×˜×•×¨ ×”××•×›×œ×œ × ×›×•×Ÿ', true);
                stepCompleted[3] = true;
                updateUI();
            } else {
                showFeedback(document.getElementById('feedback4'), 'âœ— ×‘×“×§×• ×©×•×‘ - ×¤×ª×¨×• (A-4I)w = vâ‚‚', false);
            }
        });

        // Show Step 4 solution in popup
        const popup4Overlay = document.getElementById('popup4Overlay');
        const popup4Close = document.getElementById('popup4Close');

        document.getElementById('show4').addEventListener('click', () => {
            popup4Overlay.classList.add('show');
            stepCompleted[3] = true;
            updateUI();
        });

        popup4Close.addEventListener('click', () => {
            popup4Overlay.classList.remove('show');
        });

        popup4Overlay.addEventListener('click', (e) => {
            if (e.target === popup4Overlay) {
                popup4Overlay.classList.remove('show');
            }
        });

        // DF Button Step 4
        document.getElementById('df4').addEventListener('click', () => askDigitalFriend(4));

        // Check Step 5 (particular solution)
        document.getElementById('check5').addEventListener('click', () => {
            const a1 = normalize(document.getElementById('a1-val').value);
            const a2 = normalize(document.getElementById('a2-val').value);
            const a3 = normalize(document.getElementById('a3-val').value);

            const a1Correct = a1 === '-1';
            const a2Correct = a2 === '0';
            const a3Correct = a3 === '0';

            document.getElementById('a1-val').className = a1Correct ? 'correct' : 'incorrect';
            document.getElementById('a2-val').className = a2Correct ? 'correct' : 'incorrect';
            document.getElementById('a3-val').className = a3Correct ? 'correct' : 'incorrect';

            if (a1Correct && a2Correct && a3Correct) {
                showFeedback(document.getElementById('feedback5'), 'âœ“ ××¢×•×œ×”! ×”×¤×ª×¨×•×Ÿ ×”×¤×¨×˜×™ × ×›×•×Ÿ. ×”×¤×ª×¨×•×Ÿ ×”×›×œ×œ×™ ××•×¦×’ ×œ××˜×”.', true);
                stepCompleted[4] = true;
                document.getElementById('final-answer').style.display = 'block';
                updateUI();
            } else {
                showFeedback(document.getElementById('feedback5'), 'âœ— ×‘×“×§×• ×©×•×‘ - ×¤×ª×¨×• (3I-A)a = [1,1,0]^T', false);
            }
        });

        // Show Step 5 solution in popup
        const popup5Overlay = document.getElementById('popup5Overlay');
        const popup5Close = document.getElementById('popup5Close');

        document.getElementById('show5').addEventListener('click', () => {
            popup5Overlay.classList.add('show');
            stepCompleted[4] = true;
            document.getElementById('final-answer').style.display = 'block';
            updateUI();
        });

        popup5Close.addEventListener('click', () => {
            popup5Overlay.classList.remove('show');
        });

        popup5Overlay.addEventListener('click', (e) => {
            if (e.target === popup5Overlay) {
                popup5Overlay.classList.remove('show');
            }
        });

        // DF Button Step 5
        document.getElementById('df5').addEventListener('click', () => askDigitalFriend(5));

        // Function for inline navigation buttons
        function showStep(step) {
            if (step >= 1 && step <= totalSteps) {
                currentStep = step;
                updateUI();
            }
        }

        // Initialize
        updateUI();
    </script>

<footer class="site-footer" dir="ltr">
  &copy; The Open University of Israel | Developed by Shir Sivroni
</footer>
</body>
</html>
